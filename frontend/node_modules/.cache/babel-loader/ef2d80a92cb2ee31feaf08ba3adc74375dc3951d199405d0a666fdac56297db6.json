{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { AccountController } from './AccountController.js';\nimport { ApiController } from './ApiController.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectionController } from './ConnectionController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { EventsController } from './EventsController.js';\nimport { OptionsController } from './OptionsController.js';\nimport { PublicStateController } from './PublicStateController.js';\nimport { RouterController } from './RouterController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  loading: false,\n  loadingNamespaceMap: new Map(),\n  open: false,\n  shake: false,\n  namespace: undefined\n});\n// -- Controller ---------------------------------------- //\nexport const ModalController = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  async open(options) {\n    const isConnected = AccountController.state.status === 'connected';\n    if (ConnectionController.state.wcBasic) {\n      // No need to add an await here if we are use basic\n      ApiController.prefetch({\n        fetchNetworkImages: false,\n        fetchConnectorImages: false\n      });\n    } else {\n      await ApiController.prefetch({\n        fetchConnectorImages: !isConnected,\n        fetchFeaturedWallets: !isConnected,\n        fetchRecommendedWallets: !isConnected\n      });\n    }\n    if (options?.namespace) {\n      await ChainController.switchActiveNamespace(options.namespace);\n      ModalController.setLoading(true, options.namespace);\n    } else {\n      ModalController.setLoading(true);\n    }\n    ConnectorController.setFilterByNamespace(options?.namespace);\n    const caipAddress = ChainController.getAccountData(options?.namespace)?.caipAddress;\n    const hasNoAdapters = ChainController.state.noAdapters;\n    if (hasNoAdapters && !caipAddress) {\n      if (CoreHelperUtil.isMobile()) {\n        RouterController.reset('AllWallets');\n      } else {\n        RouterController.reset('ConnectingWalletConnectBasic');\n      }\n    } else if (options?.view) {\n      RouterController.reset(options.view);\n    } else if (caipAddress) {\n      RouterController.reset('Account');\n    } else {\n      RouterController.reset('Connect');\n    }\n    state.open = true;\n    PublicStateController.set({\n      open: true\n    });\n    EventsController.sendEvent({\n      type: 'track',\n      event: 'MODAL_OPEN',\n      properties: {\n        connected: Boolean(caipAddress)\n      }\n    });\n  },\n  close() {\n    const isEmbeddedEnabled = OptionsController.state.enableEmbedded;\n    const isConnected = Boolean(ChainController.state.activeCaipAddress);\n    // Only send the event if the modal is open and is about to be closed\n    if (state.open) {\n      EventsController.sendEvent({\n        type: 'track',\n        event: 'MODAL_CLOSE',\n        properties: {\n          connected: isConnected\n        }\n      });\n    }\n    state.open = false;\n    ModalController.clearLoading();\n    if (isEmbeddedEnabled) {\n      if (isConnected) {\n        RouterController.replace('Account');\n      } else {\n        RouterController.push('Connect');\n      }\n    } else {\n      PublicStateController.set({\n        open: false\n      });\n    }\n    ConnectionController.resetUri();\n  },\n  setLoading(loading, namespace) {\n    if (namespace) {\n      state.loadingNamespaceMap.set(namespace, loading);\n    }\n    state.loading = loading;\n    PublicStateController.set({\n      loading\n    });\n  },\n  clearLoading() {\n    state.loadingNamespaceMap.clear();\n    state.loading = false;\n  },\n  shake() {\n    if (state.shake) {\n      return;\n    }\n    state.shake = true;\n    setTimeout(() => {\n      state.shake = false;\n    }, 500);\n  }\n};","map":{"version":3,"names":["proxy","subscribe","sub","subscribeKey","subKey","CoreHelperUtil","AccountController","ApiController","ChainController","ConnectionController","ConnectorController","EventsController","OptionsController","PublicStateController","RouterController","state","loading","loadingNamespaceMap","Map","open","shake","namespace","undefined","ModalController","callback","key","options","isConnected","status","wcBasic","prefetch","fetchNetworkImages","fetchConnectorImages","fetchFeaturedWallets","fetchRecommendedWallets","switchActiveNamespace","setLoading","setFilterByNamespace","caipAddress","getAccountData","hasNoAdapters","noAdapters","isMobile","reset","view","set","sendEvent","type","event","properties","connected","Boolean","close","isEmbeddedEnabled","enableEmbedded","activeCaipAddress","clearLoading","replace","push","resetUri","clear","setTimeout"],"sources":["../../../../src/controllers/ModalController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}