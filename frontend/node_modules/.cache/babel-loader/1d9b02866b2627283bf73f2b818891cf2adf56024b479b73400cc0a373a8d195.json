{"ast":null,"code":"import { proxy, subscribe as sub } from 'valtio/vanilla';\nimport { ConstantsUtil, isSafe } from '@reown/appkit-common';\nimport { CoreHelperUtil } from '../utils/CoreHelperUtil.js';\nimport { FetchUtil } from '../utils/FetchUtil.js';\nimport { AccountController } from './AccountController.js';\nimport { AlertController } from './AlertController.js';\nimport { OptionsController } from './OptionsController.js';\n// -- Helpers ------------------------------------------- //\nconst baseUrl = CoreHelperUtil.getAnalyticsUrl();\nconst api = new FetchUtil({\n  baseUrl,\n  clientId: null\n});\nconst excluded = ['MODAL_CREATED'];\n// -- State --------------------------------------------- //\nconst state = proxy({\n  timestamp: Date.now(),\n  reportedErrors: {},\n  data: {\n    type: 'track',\n    event: 'MODAL_CREATED'\n  }\n});\n// -- Controller ---------------------------------------- //\nexport const EventsController = {\n  state,\n  subscribe(callback) {\n    return sub(state, () => callback(state));\n  },\n  getSdkProperties() {\n    const {\n      projectId,\n      sdkType,\n      sdkVersion\n    } = OptionsController.state;\n    return {\n      projectId,\n      st: sdkType,\n      sv: sdkVersion || 'html-wagmi-4.2.2'\n    };\n  },\n  async _sendAnalyticsEvent(payload) {\n    try {\n      const address = AccountController.state.address;\n      if (excluded.includes(payload.data.event) || typeof window === 'undefined') {\n        return;\n      }\n      await api.post({\n        path: '/e',\n        params: EventsController.getSdkProperties(),\n        body: {\n          eventId: CoreHelperUtil.getUUID(),\n          url: window.location.href,\n          domain: window.location.hostname,\n          timestamp: payload.timestamp,\n          props: {\n            ...payload.data,\n            address\n          }\n        }\n      });\n      state.reportedErrors['FORBIDDEN'] = false;\n    } catch (err) {\n      const isForbiddenError = err instanceof Error && err.cause instanceof Response && err.cause.status === ConstantsUtil.HTTP_STATUS_CODES.FORBIDDEN && !state.reportedErrors['FORBIDDEN'];\n      if (isForbiddenError) {\n        AlertController.open({\n          shortMessage: 'Invalid App Configuration',\n          longMessage: `Origin ${isSafe() ? window.origin : 'uknown'} not found on Allowlist - update configuration on cloud.reown.com`\n        }, 'error');\n        state.reportedErrors['FORBIDDEN'] = true;\n      }\n    }\n  },\n  sendEvent(data) {\n    state.timestamp = Date.now();\n    state.data = data;\n    if (OptionsController.state.features?.analytics) {\n      EventsController._sendAnalyticsEvent(state);\n    }\n  }\n};","map":{"version":3,"names":["proxy","subscribe","sub","ConstantsUtil","isSafe","CoreHelperUtil","FetchUtil","AccountController","AlertController","OptionsController","baseUrl","getAnalyticsUrl","api","clientId","excluded","state","timestamp","Date","now","reportedErrors","data","type","event","EventsController","callback","getSdkProperties","projectId","sdkType","sdkVersion","st","sv","_sendAnalyticsEvent","payload","address","includes","window","post","path","params","body","eventId","getUUID","url","location","href","domain","hostname","props","err","isForbiddenError","Error","cause","Response","status","HTTP_STATUS_CODES","FORBIDDEN","open","shortMessage","longMessage","origin","sendEvent","features","analytics"],"sources":["../../../../src/controllers/EventsController.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}