{"ast":null,"code":"import { BaseSignerWalletAdapter, WalletAccountError, WalletConfigError, WalletDisconnectedError, WalletDisconnectionError, WalletLoadError, WalletNotConnectedError, WalletNotReadyError, WalletPublicKeyError, WalletReadyState, WalletSignTransactionError, isVersionedTransaction } from '@solana/wallet-adapter-base';\nimport { PublicKey } from '@solana/web3.js';\nimport './polyfills/index.js';\nexport const TrezorWalletName = 'Trezor';\nexport class TrezorWalletAdapter extends BaseSignerWalletAdapter {\n  constructor(config = {}) {\n    super();\n    this.name = TrezorWalletName;\n    this.url = 'https://trezor.io';\n    this.icon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA4IiBoZWlnaHQ9IjEwOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBjbGlwLXBhdGg9InVybCgjYSkiPjxwYXRoIGQ9Ik01NCAwYzI5LjgyNCAwIDU0IDI0LjE3NiA1NCA1NHMtMjQuMTc2IDU0LTU0IDU0UzAgODMuODI0IDAgNTQgMjQuMTc2IDAgNTQgMHoiIGZpbGw9IiNmZmYiLz48cGF0aCBkPSJNNzUuMjUgMzMuMzA1Qzc1LjI1IDIyLjIwNSA2NS42NjIgMTMgNTQgMTNjLTExLjY3MiAwLTIxLjI1OCA5LjIxMi0yMS4yNTggMjAuMzA1djYuNDlIMjR2NDYuNjgzTDUzLjk5IDEwMC41IDg0IDg2LjQ3NXYtNDYuNDdoLTguNzQ1bC0uMDA3LTYuNjk4LjAwMi0uMDAyem0tMzEuNjcgMGMwLTUuMjMyIDQuNTg1LTkuNDIgMTAuNDE4LTkuNDIgNS44MzUgMCAxMC40MTcgNC4xODggMTAuNDE3IDkuNDJ2Ni40OUg0My41OHYtNi40OXptMjguMzM1IDQ1LjYzN0w1My45OSA4Ny4zMmwtMTcuOTItOC4zNzJWNTAuODloMzUuODQ1djI4LjA1MnoiIGZpbGw9IiMxNzE3MTciLz48L2c+PGRlZnM+PGNsaXBQYXRoIGlkPSJhIj48cGF0aCBmaWxsPSIjZmZmIiBkPSJNMCAwaDEwOHYxMDhIMHoiLz48L2NsaXBQYXRoPjwvZGVmcz48L3N2Zz4=';\n    this.supportedTransactionVersions = new Set(['legacy', 0]);\n    this._readyState = typeof window === 'undefined' || typeof document === 'undefined' ? WalletReadyState.Unsupported : WalletReadyState.Loadable;\n    this._onDeviceEvent = event => {\n      if (event.type === 'device-disconnect') {\n        this._disconnected();\n      }\n    };\n    this._disconnected = async () => {\n      const wallet = this._wallet;\n      if (wallet) {\n        this._wallet = null;\n        this._publicKey = null;\n        try {\n          wallet.off('DEVICE_EVENT', this._onDeviceEvent);\n          wallet.dispose();\n        } catch (error) {\n          this.emit('error', new WalletDisconnectionError(error?.message, error));\n        }\n        this.emit('error', new WalletDisconnectedError());\n        this.emit('disconnect');\n      }\n    };\n    this._derivationPath = config.derivationPath || `m/44'/501'/0'/0'`;\n    this._wallet = null;\n    this._connectUrl = config.connectUrl?.replace(/\\/*$/, '/');\n    this._connecting = false;\n    this._publicKey = null;\n  }\n  get publicKey() {\n    return this._publicKey;\n  }\n  get connecting() {\n    return this._connecting;\n  }\n  get readyState() {\n    return this._readyState;\n  }\n  async connect() {\n    try {\n      if (this.connected || this.connecting) return;\n      if (this._readyState !== WalletReadyState.Loadable) throw new WalletNotReadyError();\n      this._connecting = true;\n      let wallet;\n      try {\n        const {\n          default: TrezorConnect\n        } = await import('@trezor/connect-web');\n        // @ts-expect-error // HACK: TrezorConnect.default is undefined.\n        wallet = TrezorConnect.default;\n      } catch (error) {\n        throw new WalletLoadError(error?.message, error);\n      }\n      try {\n        await wallet.init({\n          manifest: {\n            email: 'gabriel.kerekes@vacuumlabs.com',\n            appUrl: window.location.href\n          },\n          lazyLoad: true,\n          ...(this._connectUrl ? {\n            connectSrc: this._connectUrl,\n            iframeSrc: this._connectUrl\n          } : {})\n        });\n      } catch (error) {\n        throw new WalletConfigError(error?.message, error);\n      }\n      let result;\n      try {\n        result = await wallet.solanaGetPublicKey({\n          path: this._derivationPath\n        });\n      } catch (error) {\n        throw new WalletAccountError(error?.message, error);\n      }\n      if (!result.success) {\n        throw new WalletAccountError(result.payload?.error, result.payload);\n      }\n      let publicKey;\n      try {\n        publicKey = new PublicKey(Buffer.from(result.payload.publicKey, 'hex'));\n      } catch (error) {\n        throw new WalletPublicKeyError(error?.message, error);\n      }\n      wallet.on('DEVICE_EVENT', this._onDeviceEvent);\n      this._wallet = wallet;\n      this._publicKey = publicKey;\n      this.emit('connect', publicKey);\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    } finally {\n      this._connecting = false;\n    }\n  }\n  async disconnect() {\n    const wallet = this._wallet;\n    if (wallet) {\n      this._wallet = null;\n      this._publicKey = null;\n      try {\n        wallet.off('DEVICE_EVENT', this._onDeviceEvent);\n        await wallet.dispose();\n      } catch (error) {\n        this.emit('error', new WalletDisconnectionError(error?.message, error));\n      }\n      this.emit('disconnect');\n    }\n  }\n  async signTransaction(transaction) {\n    try {\n      const wallet = this._wallet;\n      const publicKey = this._publicKey;\n      if (!wallet || !publicKey) throw new WalletNotConnectedError();\n      const serializedTransaction = isVersionedTransaction(transaction) ? transaction.message.serialize() : transaction.serializeMessage();\n      let result;\n      try {\n        result = await wallet.solanaSignTransaction({\n          path: this._derivationPath,\n          serializedTx: Buffer.from(serializedTransaction).toString('hex')\n        });\n      } catch (error) {\n        throw new WalletSignTransactionError(error?.message, error);\n      }\n      if (!result.success) {\n        throw new WalletSignTransactionError(result.payload?.error, result.payload);\n      }\n      try {\n        const signature = Buffer.from(result.payload.signature, 'hex');\n        transaction.addSignature(publicKey, signature);\n      } catch (error) {\n        throw new WalletSignTransactionError(error?.message, error);\n      }\n      return transaction;\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    }\n  }\n}\n//# sourceMappingURL=adapter.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}