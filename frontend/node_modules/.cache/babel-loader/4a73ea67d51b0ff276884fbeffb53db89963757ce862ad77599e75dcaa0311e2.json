{"ast":null,"code":"import bs58 from 'bs58';\nimport { toHex } from 'viem';\nimport { ConstantsUtil } from '@reown/appkit-common';\nimport { AccountController, ChainController, ConstantsUtil as CoreConstantsUtil, CoreHelperUtil } from '@reown/appkit-controllers';\nimport { AdapterBlueprint } from '../adapters/ChainAdapterBlueprint.js';\nimport { WalletConnectConnector } from '../connectors/WalletConnectConnector.js';\nimport { WcConstantsUtil } from '../utils/ConstantsUtil.js';\nexport class UniversalAdapter extends AdapterBlueprint {\n  setUniversalProvider(universalProvider) {\n    this.addConnector(new WalletConnectConnector({\n      provider: universalProvider,\n      caipNetworks: this.caipNetworks || [],\n      namespace: this.namespace\n    }));\n  }\n  async connect(params) {\n    return Promise.resolve({\n      id: 'WALLET_CONNECT',\n      type: 'WALLET_CONNECT',\n      chainId: Number(params.chainId),\n      provider: this.provider,\n      address: ''\n    });\n  }\n  async disconnect() {\n    try {\n      const connector = this.getWalletConnectConnector();\n      await connector.disconnect();\n    } catch (error) {\n      console.warn('UniversalAdapter:disconnect - error', error);\n    }\n  }\n  async getAccounts({\n    namespace\n  }) {\n    const provider = this.provider;\n    const addresses = provider?.session?.namespaces?.[namespace]?.accounts?.map(account => {\n      const [,, address] = account.split(':');\n      return address;\n    }).filter((address, index, self) => self.indexOf(address) === index) || [];\n    return Promise.resolve({\n      accounts: addresses.map(address => CoreHelperUtil.createAccount(namespace, address, namespace === 'bip122' ? 'payment' : 'eoa'))\n    });\n  }\n  async syncConnectors() {\n    return Promise.resolve();\n  }\n  async getBalance(params) {\n    const isBalanceSupported = params.caipNetwork && CoreConstantsUtil.BALANCE_SUPPORTED_CHAINS.includes(params.caipNetwork?.chainNamespace);\n    if (!isBalanceSupported || params.caipNetwork?.testnet) {\n      return {\n        balance: '0.00',\n        symbol: params.caipNetwork?.nativeCurrency.symbol || ''\n      };\n    }\n    if (AccountController.state.balanceLoading && params.chainId === ChainController.state.activeCaipNetwork?.id) {\n      return {\n        balance: AccountController.state.balance || '0.00',\n        symbol: AccountController.state.balanceSymbol || ''\n      };\n    }\n    const balances = await AccountController.fetchTokenBalance();\n    const balance = balances.find(b => b.chainId === `${params.caipNetwork?.chainNamespace}:${params.chainId}` && b.symbol === params.caipNetwork?.nativeCurrency.symbol);\n    return {\n      balance: balance?.quantity.numeric || '0.00',\n      symbol: balance?.symbol || params.caipNetwork?.nativeCurrency.symbol || ''\n    };\n  }\n  async signMessage(params) {\n    const {\n      provider,\n      message,\n      address\n    } = params;\n    if (!provider) {\n      throw new Error('UniversalAdapter:signMessage - provider is undefined');\n    }\n    let signature = '';\n    if (ChainController.state.activeCaipNetwork?.chainNamespace === ConstantsUtil.CHAIN.SOLANA) {\n      const response = await provider.request({\n        method: 'solana_signMessage',\n        params: {\n          message: bs58.encode(new TextEncoder().encode(message)),\n          pubkey: address\n        }\n      }, ChainController.state.activeCaipNetwork?.caipNetworkId);\n      signature = response.signature;\n    } else {\n      signature = await provider.request({\n        method: 'personal_sign',\n        params: [message, address]\n      }, ChainController.state.activeCaipNetwork?.caipNetworkId);\n    }\n    return {\n      signature\n    };\n  }\n  // -- Transaction methods ---------------------------------------------------\n  /**\n   *\n   * These methods are supported only on `wagmi` and `ethers` since the Solana SDK does not support them in the same way.\n   * These function definition is to have a type parity between the clients. Currently not in use.\n   */\n  async estimateGas() {\n    return Promise.resolve({\n      gas: BigInt(0)\n    });\n  }\n  async getProfile() {\n    return Promise.resolve({\n      profileImage: '',\n      profileName: ''\n    });\n  }\n  async sendTransaction() {\n    return Promise.resolve({\n      hash: ''\n    });\n  }\n  walletGetAssets(_params) {\n    return Promise.resolve({});\n  }\n  async writeContract() {\n    return Promise.resolve({\n      hash: ''\n    });\n  }\n  async getEnsAddress() {\n    return Promise.resolve({\n      address: false\n    });\n  }\n  parseUnits() {\n    return 0n;\n  }\n  formatUnits() {\n    return '0';\n  }\n  async getCapabilities() {\n    return Promise.resolve({});\n  }\n  async grantPermissions() {\n    return Promise.resolve({});\n  }\n  async revokePermissions() {\n    return Promise.resolve('0x');\n  }\n  async syncConnection() {\n    return Promise.resolve({\n      id: 'WALLET_CONNECT',\n      type: 'WALLET_CONNECT',\n      chainId: 1,\n      provider: this.provider,\n      address: ''\n    });\n  }\n  // eslint-disable-next-line @typescript-eslint/require-await\n  async switchNetwork(params) {\n    const {\n      caipNetwork\n    } = params;\n    const connector = this.getWalletConnectConnector();\n    if (caipNetwork.chainNamespace === ConstantsUtil.CHAIN.EVM) {\n      try {\n        await connector.provider?.request({\n          method: 'wallet_switchEthereumChain',\n          params: [{\n            chainId: toHex(caipNetwork.id)\n          }]\n        });\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      } catch (switchError) {\n        if (switchError.code === WcConstantsUtil.ERROR_CODE_UNRECOGNIZED_CHAIN_ID || switchError.code === WcConstantsUtil.ERROR_INVALID_CHAIN_ID || switchError.code === WcConstantsUtil.ERROR_CODE_DEFAULT || switchError?.data?.originalError?.code === WcConstantsUtil.ERROR_CODE_UNRECOGNIZED_CHAIN_ID) {\n          try {\n            await connector.provider?.request({\n              method: 'wallet_addEthereumChain',\n              params: [{\n                chainId: toHex(caipNetwork.id),\n                rpcUrls: [caipNetwork?.rpcUrls['chainDefault']?.http],\n                chainName: caipNetwork.name,\n                nativeCurrency: caipNetwork.nativeCurrency,\n                blockExplorerUrls: [caipNetwork.blockExplorers?.default.url]\n              }]\n            });\n          } catch (error) {\n            throw new Error('Chain is not supported');\n          }\n        }\n      }\n    }\n    connector.provider.setDefaultChain(caipNetwork.caipNetworkId);\n  }\n  getWalletConnectProvider() {\n    const connector = this.connectors.find(c => c.type === 'WALLET_CONNECT');\n    const provider = connector?.provider;\n    return provider;\n  }\n}","map":{"version":3,"names":["bs58","toHex","ConstantsUtil","AccountController","ChainController","CoreConstantsUtil","CoreHelperUtil","AdapterBlueprint","WalletConnectConnector","WcConstantsUtil","UniversalAdapter","setUniversalProvider","universalProvider","addConnector","provider","caipNetworks","namespace","connect","params","Promise","resolve","id","type","chainId","Number","address","disconnect","connector","getWalletConnectConnector","error","console","warn","getAccounts","addresses","session","namespaces","accounts","map","account","split","filter","index","self","indexOf","createAccount","syncConnectors","getBalance","isBalanceSupported","caipNetwork","BALANCE_SUPPORTED_CHAINS","includes","chainNamespace","testnet","balance","symbol","nativeCurrency","state","balanceLoading","activeCaipNetwork","balanceSymbol","balances","fetchTokenBalance","find","b","quantity","numeric","signMessage","message","Error","signature","CHAIN","SOLANA","response","request","method","encode","TextEncoder","pubkey","caipNetworkId","estimateGas","gas","BigInt","getProfile","profileImage","profileName","sendTransaction","hash","walletGetAssets","_params","writeContract","getEnsAddress","parseUnits","formatUnits","getCapabilities","grantPermissions","revokePermissions","syncConnection","switchNetwork","EVM","switchError","code","ERROR_CODE_UNRECOGNIZED_CHAIN_ID","ERROR_INVALID_CHAIN_ID","ERROR_CODE_DEFAULT","data","originalError","rpcUrls","http","chainName","name","blockExplorerUrls","blockExplorers","default","url","setDefaultChain","getWalletConnectProvider","connectors","c"],"sources":["../../../../src/universal-adapter/client.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}